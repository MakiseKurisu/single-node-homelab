<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Single Node Homelab</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="Introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="Hardware.html"><strong aria-hidden="true">1.</strong> Hardware</a></li><li class="chapter-item expanded "><a href="Software.html"><strong aria-hidden="true">2.</strong> Software</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="debian-guest.html"><strong aria-hidden="true">2.1.</strong> Create Debian Guest</a></li><li class="chapter-item expanded "><a href="samba-ad-dc.html"><strong aria-hidden="true">2.2.</strong> Set up Samba Active Directory Domain Controller</a></li><li class="chapter-item expanded "><a href="samba-ad-member.html"><strong aria-hidden="true">2.3.</strong> Join Samba Active Directory Domain</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Single Node Homelab</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/MakiseKurisu/single-node-homelab/tree/main" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<blockquote>
<p>Self hosting at home doesn't mean you need server racks or used enterprise leaf blowers. In fact, you could start with your existing gaming PC.</p>
</blockquote>
<h2 id="a-little-bit-of-background"><a class="header" href="#a-little-bit-of-background">A little bit of background</a></h2>
<p>Back when I was still a college student, a laptop was all I need. My music and games went everywhere with me, along with my study material. There was no need to host them elsewhere since I need to bring my laptop anyway.</p>
<p>After graduating, I no longer need to bring my laptop with me to work, and the game I was playing was CPU and GPU bounded, so a gaming tower was on my wish list. Coincidentally, as I also needed to do some IT works for the company, I discovered <a href="https://www.reddit.com/r/homelab/"><code>r/homelab</code></a> while learning different hypervisors. I had never heard about <a href="https://www.proxmox.com/en/">Proxmox</a> until <code>r/homelab</code> introduced it to me.</p>
<p>Fast forwards a few years, I have set up multiple single-node Proxmox installations for various personal and professional needs. I feel like right now is the time for me to properly document my setup and process (I do have <a href="https://gist.github.com/MakiseKurisu/">some gists</a> written that may or may not have helped me get the current job), so I can easily replicate my setup in the future, and also provide some resource back to the community.</p>
<h2 id="why-single-node"><a class="header" href="#why-single-node">Why single node?</a></h2>
<p>Single node is not a choice but a compromise. I wish to expand to a proper multi node HA setup soon, but the following conditions limited my ability to do so (which could happen to you as well):</p>
<ol>
<li>Initial investment. Multi node setup requires a greater initial investment, while the benefit of higher up-time is not as important for personal and even some professional use. Single node setup usually uses existing hardware so the opportunity cost is way smaller.</li>
<li>Performance, heat, electricity, space, and noise with used enterprise type of equipments. A common way to reduce the initial investment is to use 2nd hand enterprise equipment, and pay more on the operational cost. However, this is not possible for me since A, the operational cost as a renter is not a small amount (I pay electricity at the above commercial rate for example) so I want to minimize those as well; and B, it is hard to fit cheap consumer GPU on the rack server and CPU on those are usually quite old and clock limited, so not ideal for gaming. My first virtualized host was a ThinkStation D30 with dual Xeon E5-2667v2, and it wasn't much faster than my Thinkpad W540 during gaming.</li>
</ol>
<p>Currently, I'm eyeing ARM based hyper converged cluster as a cheaper way to have multi node cluster for service hosting. Then I can convert my single node host into a normal Linux machine for gaming. Until then, single node is the way for me.</p>
<h2 id="but-homelab-is-for-messing-with-the-enterprise-network-and-enterprise-hypervisor-and-so-on"><a class="header" href="#but-homelab-is-for-messing-with-the-enterprise-network-and-enterprise-hypervisor-and-so-on">But homelab is for messing with the enterprise network and enterprise hypervisor and so on!</a></h2>
<p>While this is true as that is what homelab means initially, right now <code>r/homelab</code> is more of a place for self-hosting home production infrastructure. Throughout this book, we are gonna host some services, set up VLANs, and create Active Directory domain with WPA-Enterprise wireless network. I think those are enterprisey enough to call what we create a homelab, and those are useful for small businesses (which is my background).</p>
<h2 id="then-why-there-are-a-lot-of-missing-chapters"><a class="header" href="#then-why-there-are-a-lot-of-missing-chapters">Then why there are a lot of missing chapters?</a></h2>
<p>For this book, I'm going to write it while I set up the system. Currently, I have 3 single node systems that need to be set up, so I'll pen the part I'm doing first before moving to other sections.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hardware"><a class="header" href="#hardware">Hardware</a></h1>
<p>As I'm managing a few different environments the hardware requirements are slightly different. Below suggestions are based on my personal environment.</p>
<h2 id="what-specs-should-i-look-for"><a class="header" href="#what-specs-should-i-look-for">What specs should I look for?</a></h2>
<p>First, check <a href="https://www.reddit.com/r/homelab/wiki/index"><code>r/homelab</code></a> and <a href="https://www.reddit.com/r/homelab/wiki/index"><code>r/DataHoarder</code></a> wiki. Their hardware guides should give you a good start.</p>
<h3 id="case"><a class="header" href="#case">Case</a></h3>
<p>For the case, I prefer ATX tower with a lot of hard drive bays. I have built 2 NZXT Source 220 based systems (one sold when I moved and one currently in use) and am very happy about this case. Sadly this cheap case is no longer in manufacture so you have to <em>source</em> it from 2nd hand market. It has 8 3.5-inch bays and 3 5.25 bays which can be adapted to 5 more 3.5-inch bays, giving you a total of 13 hard drive bays. Not all 8 3.5 bays are usable when GPU is plugged in, but that raw number combined with the fact that the price of an 18TB hard drive has been bearable due to crypto crash means this case can probably meet a lot of people's storage need.</p>
<p>If you cannot find a used Source 220, Fractal Design Meshify 2 XL will be my next choice. Yes, we just jumped from a cheap ass case to a top-of-the-line premium case, but ultimately Meshify 2 XL is the only other case that I know that can house even more hard drives AND a 3rd GPU. Most cases these days no longer prioritize hard drive bays so not a lot of choices are available. Case has a very long life so if you are OK with how big it is this case should last you a long time.</p>
<h3 id="power-supply"><a class="header" href="#power-supply">Power supply</a></h3>
<p>Aim for a modular power supply over 750W with the Gold rating or higher. Like the case, PSU last a long time, and a beefy one can survive multiple upgrade cycles when more hard drives or GPUs are added. 2nd hand PSU is not recommended but that was what I did anyway. On one hand, I still save money even when <strong>2</strong> failed and I had to buy the 3rd one. On the other hand downtime and playing your data with fire. I have mixed feelings but I probably will keep doing it just because I'm so cheap.</p>
<h3 id="platform"><a class="header" href="#platform">Platform</a></h3>
<p>AM4 platform is EOL but there is still plenty of life left in this platform. You can also use AM4 cooler on AM5 so get a good one. Motherboards are recommended in the following order:</p>
<ol>
<li>ASRock Fatal1ty X370 Professional Gaming (what I'm using right now)</li>
<li>ASRock X470 Taichi Ultimate</li>
<li>ASRock X370 Taichi</li>
<li>X570 boards with multi-gig Ethernet, but just get ASRock X370 Taichi</li>
</ol>
<p>This is mostly based on network connectivity. X370 PG is the only X370 with 5GbE and X470 TU is the only X470 with 10GbE (excluding the ASRock Rack offering which is a lot more expensive). Being the halo products they, unfortunately, have very limited availability (especially X470 TU). In that case, I'll just go with X370 Taichi which is X370 PG minus the 5GbE, and rely on a USB or PCIe network card if I do need the extra port or bandwidth.</p>
<p>This bias for ASRock is also due to them being the first vendor to support Ryzen 5000 series on their X370 motherboard long before AMD eased the restriction, making them the only choice for the cheap used motherboard. Right now a lot of other vendors have added the support on their X370 boards as well, but they do not have better NIC so the calculation is still the same.</p>
<p>One final thing is <a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Ensuring_that_the_groups_are_valid">IOMMU group</a>. Motherboard with good IOMMU grouping means you can easily pass devices to the guest. ACS override is a hack and a source of instability so I don't think it is worth doing. For X370PG (and likely Taichi) the 2 X8/16 slots and the M.2 slot are all in separate IOMMU groups so you can use them for GPU passthrough. As for motherboard peripherals, most of them are in the same group except for the USB 3.0 controller and the audio controller. Not the best but I can live with this.</p>
<p>For CPU I'm currently using Ryzen 7 3700X which is the generation where AMD's gaming performance caught up with Intel and before they jacked up the price on 5000 series. 3700X being the cheaper 8-core offering from this generation with a box cooler means you can get them together for cheap. If your budget cannot afford this you can check earlier 8-core offering 1700/2700, as well as 6-core offering 1600AF/3600, based on your requirement of single and multi-threaded performance.</p>
<p>Moving forward there is also an upgrade path of 3900X/3950X and 5900X/5950X. 5900X is the most likely candidate for the improved core count and IPC, while likely being cheaper per core than 5950X in a few years. After 5900X is no longer performant AM5 platform and DDR5 should be mature enough with a good 2nd hand market.</p>
<h3 id="memory"><a class="header" href="#memory">Memory</a></h3>
<p>Right now I'm using 2x32GB 3200MHz ECC ram. My workstation has been 32GB for a long time so pairing another 32GB for services and 2nd GPU VM makes sense. This also leaves me an upgrade path to 128GB memory should I need that much (which can be possible if using vGPU for virtual desktops). So the recommendation is to put the double amount of memory you are currently using to the host.</p>
<h3 id="gpu"><a class="header" href="#gpu">GPU</a></h3>
<p>To use <a href="https://github.com/DualCoder/vgpu_unlock">vGPU unlock</a>, you need Maxwell/Pascal/Turing based Nvidia GPU and a good amount of vram to be useful. Some recommended cards are Tesla M40/P40 24GB for dedicated vGPU, or Geforce Titan X (Pascal) / Geforce GTX 1080 Ti for using the combined driver. Those cards have a good amount of vram while fast enough to be comfortably shared by many guests. Since we only have 2-3 PCIe slots for GPU a cheaper one basically &quot;wastes&quot; it, but they can be used nonetheless. With a Titan X you don't have to mess with cooling and can use as a passthrough GPU for now. Once you need a better GPU (that may not be supported by vGPU unlock), you can still share it with guests, maximizing the use-value.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="software"><a class="header" href="#software">Software</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create-debian-guest"><a class="header" href="#create-debian-guest">Create Debian Guest</a></h1>
<h2 id="configure"><a class="header" href="#configure">Configure</a></h2>
<pre><code>apt update &amp;&amp; apt install -y ssh &amp;&amp; systemctl enable ssh &amp;&amp; poweroff

su -
apt install -y bash-completion tmux sudo
apt install -y samba winbind libnss-winbind libpam-winbind krb5-user libpam-krb5
apt install -y systemd-timesyncd
timedatectl set-ntp true
systemctl enable --now serial-getty@ttyS0
nano /etc/network/interfaces
# Add `iface enp6s18 inet6 dhcp`
usermod -a -G sudo YOUR_USER
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="set-up-samba-active-directory-domain-controller"><a class="header" href="#set-up-samba-active-directory-domain-controller">Set up Samba Active Directory Domain Controller</a></h1>
<p>In this chapter, we will set up an AD domain controller with DNS and NTP services.</p>
<h2 id="install-dependency"><a class="header" href="#install-dependency">Install dependency</a></h2>
<p>To be updated</p>
<pre><code>sudo apt install -y smbclient ntp
</code></pre>
<h2 id="preparation"><a class="header" href="#preparation">Preparation</a></h2>
<p>If you follow <a href="./debian-guest.html">Debian guest</a> chapter then below are all you need to do. Otherwise, check <a href="https://wiki.samba.org/index.php/Setting_up_Samba_as_an_Active_Directory_Domain_Controller#Preparing_the_Installation">the official Samba Wiki</a>.</p>
<pre><code>sudo systemctl disable --now smbd nmbd winbind
sudo sed -nie &quot;p; s/127.0.1.1/$(ip -o -6 addr | grep -v -e &quot;1: lo&quot; -e &quot;dynamic&quot; -e &quot;link&quot; | head -n 1 | awk '{print $4}' | cut -d/ -f1)/p&quot; /etc/hosts
sudo sed -ie &quot;s/127.0.1.1/$(ip -o -4 addr | grep -v &quot;1: lo&quot; | awk '{print $4}' | cut -d/ -f1)/&quot; /etc/hosts
sudo rm -rf /etc/samba/smb.conf /run/samba /var/lib/samba /var/cache/samba /etc/krb5.conf
sudo mkdir -p /var/lib/samba/private
</code></pre>
<h2 id="provision"><a class="header" href="#provision">Provision</a></h2>
<p>Default configs work fine so just need to put your password here:</p>
<pre><code>sudo samba-tool domain provision --interactive --use-rfc2307
sudo nano /etc/samba/smb.conf
#
# Add the following line in [global] section
#
# template shell = /bin/bash
# template homedir = /home/%U
# winbind use default domain = yes
#
sudo sed -i -e &quot;s/passwd:\s*files/passwd: files winbind/&quot; -e &quot;s/group:\s*files/group: files winbind/&quot; /etc/nsswitch.conf
echo &quot;session required pam_mkhomedir.so&quot; | sudo tee -a /etc/pam.d/common-session
echo &quot;domain YOUR.DNS.DOMAIN&quot; | sudo tee -a /etc/resolv.conf
echo &quot;search YOUR.DNS.DOMAIN&quot; | sudo tee -a /etc/resolv.conf
sudo cp /var/lib/samba/private/krb5.conf /etc/krb5.conf
sudo sed -ie &quot;s/default kod notrap nomodify nopeer noquery limited/default kod notrap nomodify nopeer limited mssntp/g&quot; /etc/ntp.conf
echo &quot;ntpsigndsocket /var/lib/samba/ntp_signd/&quot; | sudo tee -a /etc/ntp.conf
sudo chown root:ntp /var/lib/samba/ntp_signd
sudo systemctl restart ntp
</code></pre>
<p>Now update your OpenWrt setting to use AD DC's DNS:</p>
<pre><code>uci set dhcp.@dnsmasq[0].domain='YOUR.DNS.DOMAIN'
uci set dhcp.@dnsmasq[0].local='/YOUR.DNS.DOMAIN/AD.DOMAIN.CONTROLLER.IP'
uci add_list dhcp.guest.dhcp_option='42,AD.DOMAIN.CONTROLLER.IP' # NTP Server
uci commit
/etc/init.d/dnsmasq restart
</code></pre>
<h2 id="check-if-ad-dc-is-working"><a class="header" href="#check-if-ad-dc-is-working">Check if AD DC is working</a></h2>
<pre><code>AD_REALM=SAMDOM.EXAMPLE.COM
DC=DC01

sudo samba # automatically running in the background
smbclient -L localhost -N
smbclient //localhost/netlogon -UAdministrator -c 'ls'
host -t SRV _ldap._tcp.${AD_REALM}
host -t SRV _kerberos._udp.${AD_REALM}
host -t A ${DC}.${AD_REALM}.
kinit administrator
klist
</code></pre>
<h2 id="enable-sambe-permanently"><a class="header" href="#enable-sambe-permanently">Enable Sambe permanently</a></h2>
<pre><code>sudo systemctl unmask samba-ad-dc
sudo systemctl enable samba-ad-dc
sudo reboot
</code></pre>
<h2 id="reference"><a class="header" href="#reference">Reference</a></h2>
<p><a href="https://wiki.samba.org/index.php/Setting_up_Samba_as_an_Active_Directory_Domain_Controller">Samba Wiki</a>
<a href="https://wiki.samba.org/index.php/Configuring_Winbindd_on_a_Samba_AD_DC">Samba Wiki-Winbind</a>
<a href="https://wiki.archlinux.org/title/Samba/Active_Directory_domain_controller">Arch Wiki</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="join-samba-active-directory-domain"><a class="header" href="#join-samba-active-directory-domain">Join Samba Active Directory Domain</a></h1>
<p>In this chapter, we will join our existing AD domain.</p>
<h2 id="preparation-1"><a class="header" href="#preparation-1">Preparation</a></h2>
<pre><code>sudo systemctl stop smbd nmbd winbind
sudo rm -rf /etc/samba/smb.conf /run/samba /var/lib/samba /var/cache/samba /etc/krb5.conf
sudo mkdir -p /var/lib/samba/private
sudo sed -ie &quot;s/^127.0.1.1.*$//&quot; /etc/hosts
</code></pre>
<h2 id="check-if-ad-dns-is-working"><a class="header" href="#check-if-ad-dns-is-working">Check if AD DNS is working</a></h2>
<pre><code>AD_REALM=SAMDOM.EXAMPLE.COM
DC=DC01

host -t SRV _ldap._tcp.${AD_REALM}
host -t SRV _kerberos._udp.${AD_REALM}
host -t A ${DC}.${AD_REALM}.
host AD.DOMAIN.CONTROLLER.IP
</code></pre>
<h2 id="configure-kerberos-and-samba"><a class="header" href="#configure-kerberos-and-samba">Configure Kerberos and Samba</a></h2>
<pre><code>AD_REALM=SAMDOM.EXAMPLE.COM
WORKGROUP=SAMDOM

cat &lt;&lt; EOF | sudo tee /etc/krb5.conf
[libdefaults]
    default_realm = ${AD_REALM}
    dns_lookup_realm = false
    dns_lookup_kdc = true
EOF

cat &lt;&lt; EOF | sudo tee /etc/samba/smb.conf
[global]
    security = ADS
    workgroup = ${WORKGROUP}
    realm = ${AD_REALM}

    idmap config * : backend = autorid
    idmap config * : range = 10000-9999999

    username map = /usr/local/samba/etc/user.map

    template shell = /bin/bash
    template homedir = /home/%U
    winbind use default domain = yes
EOF

sudo mkdir -p /usr/local/samba/etc/
echo '!root = ${WORKGROUP}\Administrator' | sudo tee /usr/local/samba/etc/user.map
</code></pre>
<h2 id="joining-domain"><a class="header" href="#joining-domain">Joining domain</a></h2>
<pre><code>sudo net ads join -U Administrator
sudo systemctl start smbd nmbd winbind
sudo sed -i -e &quot;s/passwd:\s*files/passwd: files winbind/&quot; -e &quot;s/group:\s*files/group: files winbind/&quot; /etc/nsswitch.conf
echo &quot;session required pam_mkhomedir.so&quot; | sudo tee -a /etc/pam.d/common-session
</code></pre>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<pre><code>wbinfo --ping-dc
getent passwd SAMDOM\\Administrator
getent group &quot;SAMDOM\\Domain Users&quot;
touch /tmp/samba_test
sudo chown &quot;SAMDOM\\Administrator:SAMDOM\\Domain Users&quot; /tmp/samba_test
ls -la /tmp/samba_test
</code></pre>
<h2 id="reference-1"><a class="header" href="#reference-1">Reference</a></h2>
<p><a href="https://wiki.samba.org/index.php/Setting_up_Samba_as_a_Domain_Member">Samba Wiki</a>
<a href="https://wiki.samba.org/index.php/Authenticating_Domain_Users_Using_PAM">Samba Wiki-Winbind</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
